
@{
    ViewBag.Title = "Logi Sisse";
}

<h2>Logi Sisse</h2>

<div class="container">
    <div class="row">
        <form id="login">
            <div class="form-group">
                <label for="exampleInputEmail1">Email</label>
                <input type="text" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Teie email" required>
            </div>
            <div class="form-group">
                <label for="exampleInputPassword1">Salasõna</label>
                <input type="password" class="form-control" id="password" placeholder="Teie salasõna" required>
            </div>
            <button type="submit" class="btn btn-primary">Logi Sisse            <i class="fa fa-sign-in" aria-hidden="true"></i></button>
            <hr />
            <p>Kas soovite registreeruda? <a href="../../Home/Register">Registreerima praegu</a>.</p>
            <div id="alert-error"></div>
        </form>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#login').submit(function (e) {
            e.preventDefault();

            const email = $('#email').val();
            const password = $('#password').val();
            const data = {
                'email': email,
                'password': password
            };

            $.ajax({
                method: "post",
                url: "../../api/login",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify(data)
            }).done(function (data) {
                if (data.ResultCode == 200) {
                    window.location.href = "../../Home/Index";
                } else {
                    $('#alert-error').html(`
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <h5><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Ошибка</h5>
                        ${data.ResultMessage}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                `);
                }
            });
        })
    })
</script>